sflinks = [ [ 'linux-base', 'redfish-base' ], [ 'manual-structure-base', 'redfish-base' ] ]

[ foundation.redfish-base ]
  description = 'Base Redfish'
  scripts = { 'create' = 'redfish-create', 'destroy' = 'redfish-destroy', 'wipe' = 'redfish-firmware', 'firmware' = 'redfish-firmware' }
  foundation_types = [ 'RedFish' ]
  config_values = {}
  template = {}
  physical_interface_names = [ 'eth0' ]

[ script.redfish-create ]
  description = 'Create RedFish Server'
  script = """# Test and Configure RedFish Server
while not foundation.link_test() do
begin()
  pause( msg="IPMI Link test failed, resume to try again." )
end
foundation.wait_for_poweroff()

begin( description='Wipe Disks' )
  signaling.reset( pxe_name='disk-wipe' )
  dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='disk-wipe' )
  foundation.power_on()
  delay( seconds=60 )
  signaling.wait_for_completion()
  foundation.wait_for_poweroff()
end

begin( description='Set RTC' )
  signaling.reset( pxe_name='set-rtc' )
  dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='set-rtc' )
  foundation.power_on()
  delay( seconds=60 )
  signaling.wait_for_completion()
  foundation.wait_for_poweroff()
end

begin( description='Check Firmware' )
  signaling.reset( pxe_name='firmware' )
  dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='firmware' )
  foundation.power_on()
  delay( seconds=60 )
  signaling.wait_for_completion()
  foundation.wait_for_poweroff()
end

dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='normal-boot' )
"""

[ script.redfish-destroy ]
  description = 'Destroy RedFish Server'
  script = """# Decommission RedFish Server
foundation.power_off()

begin( description='Wipe Disks' )
  signaling.reset( pxe_name='disk-wipe' )
  dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='disk-wipe' )
  foundation.power_on()
  delay( seconds=60 )
  signaling.wait_for_completion()
  foundation.wait_for_poweroff()
end

dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='normal-boot' )
"""

[ script.redfish-wipe ]
  description = 'Full RedFish Machine Wipe'
  script = """# Fully Wipe the RedFish Machine
foundation.wait_for_poweroff()

begin( description='Full Disk Wipe' )
  signaling.reset( pxe_name='disk-wipe' )
  dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='disk-wipe-single_pass' )
  foundation.power_on()
  delay( seconds=60 )
  signaling.wait_for_completion()
  foundation.wait_for_poweroff()
end

# other hardware wipe?

dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='normal-boot' )
"""

[ script.redfish-firmware ]
  description = 'Firmware Check RedFish Server'
  script = """# Firmware Check RedFish Server
foundation.power_off()

begin( description='Check Firmware' )
  signaling.reset( pxe_name='firmware' )
  dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='firmware' )
  foundation.power_on()
  delay( seconds=60 )
  signaling.wait_for_completion()
  foundation.wait_for_poweroff()
end

dhcp.set_pxe( interface=foundation.provisioning_interface, pxe='normal-boot' )
"""
