sflinks = [ [ 'linux-base', 'packet-device-base' ], [ 'manual-structure-base', 'packet-device-base' ]  ]

[ foundation.packet-device-base ]
  description = 'Base Packet Device'
  scripts = { 'create' = 'packet-device-create', 'destroy' = 'packet-device-destroy' }
  foundation_types = [ 'Packet' ]
  template = {}
  physical_interface_names = []
[ foundation.packet-device-base.config_values ]
  packet_plan = '18e285e0-1872-11ea-8d71-362b9e155667'

[ script.packet-device-create ]
  description = 'Create Packet Device'
  script = """# Create Packet Device
device_spec = foundation.packet_devicespec

begin( description='Device Creation' )
  device_uuid = packet.create( device_spec=device_spec )
  foundation.packet_uuid = device_uuid
  foundation.sync_networking_info()
  counter = 0
  while ( counter < 60 ) do
  begin()
    delay( seconds=10 )
    state = foundation.device_state()
    if ( state == 'active' ) then goto done
    message( msg=( ( 'waiting for device to provision, curently: "' . state ) . '"' ) )
    counter = ( counter + 1 )
  end
  while( foundation.device_state() != 'active' ) do
    error( msg='timeout waiting for device to provision' )
end
:done
"""

[ script.packet-device-destroy ]
  description = 'Destroy Packet Device'
  script = """# Destory Packet Device
begin( description='Device Destruction' )
  foundation.power_off()
  foundation.destroy()
  foundation.packet_uuid = None
end
"""
